let map,distance,storeMarker={lat:"",lng:""};const loadMap=()=>{map=new google.maps.Map(document.getElementById("map"),{center:{lat:42.352271,lng:-71.055242},zoom:13})},applyRideMarkers=(e,t,a)=>{e.forEach(e=>{let n=Math.floor(google.maps.geometry.spherical.computeDistanceBetween({lat:t,lng:a},{lat:e.lat,lng:e.lng})/1609.344);(n<distance||!distance)&&(distance=n,storeMarker.lat=e.lat,storeMarker.lng=e.lng);let r=new google.maps.InfoWindow({content:n.toString()+" miles away"}),o=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},icon:"car.png"});o.addListener("click",()=>{r.open({anchor:o,map})}),o.setMap(map)})},applyCurrentLocationMarker=(e,t)=>{let a=new google.maps.InfoWindow({content:distance.toString()+" miles to nearest ride"}),n=new google.maps.Marker({position:{lat:e,lng:t}});n.setMap(map),n.addListener("click",()=>{a.open({anchor:n,map})});let r=[{lat:e,lng:t},{lat:storeMarker.lat,lng:storeMarker.lng},],o=new google.maps.Polyline({path:r,strokeColor:"blue",strokeOpacity:1,strokeWeight:2});o.setMap(map)},loadMarkers=()=>{navigator.geolocation.getCurrentPosition(e=>{let t=e.coords.latitude,a=e.coords.longitude,n=new google.maps.LatLng(t,a);map.setCenter(n);let r=new XMLHttpRequest,o="username=DCEZBDzN&lat="+t+"&lng="+a;r.open("POST","https://vast-shore-91078.herokuapp.com/rides",!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=()=>{if(4==r.readyState&&200==r.status){document.getElementById("cover-spin").hidden=!0;let e=JSON.parse(r.responseText);applyRideMarkers(e,t,a),applyCurrentLocationMarker(t,a)}},r.send(o)})};window.initMap=()=>{loadMap(),loadMarkers()};